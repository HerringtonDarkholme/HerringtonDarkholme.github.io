<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Type Safe Routing for Vue.js | Abitrarily Idiosyncratic Randomness</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Vue router is elegant and type safe enough for most use cases. But I want to experiment how far typescript can help us.
Typesafe routing isn’t easy to do.
The easiest way to declare multiple class and">
<meta property="og:type" content="article">
<meta property="og:title" content="Type Safe Routing for Vue.js">
<meta property="og:url" content="http://herringtondarkholme.github.io/2016/10/02/vue-router/index.html">
<meta property="og:site_name" content="Abitrarily Idiosyncratic Randomness">
<meta property="og:description" content="Vue router is elegant and type safe enough for most use cases. But I want to experiment how far typescript can help us.
Typesafe routing isn’t easy to do.
The easiest way to declare multiple class and">
<meta property="og:updated_time" content="2016-10-02T14:16:59.525Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Type Safe Routing for Vue.js">
<meta name="twitter:description" content="Vue router is elegant and type safe enough for most use cases. But I want to experiment how far typescript can help us.
Typesafe routing isn’t easy to do.
The easiest way to declare multiple class and">
  
    <link rel="alternative" href="/atom.xml" title="Abitrarily Idiosyncratic Randomness" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Abitrarily Idiosyncratic Randomness</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Hchan&#39;s Note</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://herringtondarkholme.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-vue-router" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/02/vue-router/" class="article-date">
  <time datetime="2016-10-01T16:00:00.000Z" itemprop="datePublished">2016-10-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Type Safe Routing for Vue.js
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Vue router is elegant and type safe enough for most use cases. But I want to experiment how far typescript can help us.</p>
<p>Typesafe routing isn’t easy to do.</p>
<p>The easiest way to declare multiple class and instantatiate their paramater type. For example, <a href="https://github.com/angryzor/typesafe-urls" target="_blank" rel="external">typed-url</a>. But this is too verbose.</p>
<p>Another approach is to use functional <strong>combinator</strong>. To put it simple, combinator is high order function that can abstract various operation. Routing combinators usually are a bunch of functions that can accept strings as static url segment or a function as dynamic url parameter. Both <a href="https://github.com/slamdata/purescript-routing/blob/master/GUIDE.md" target="_blank" rel="external">purescript</a> and <a href="https://speakerdeck.com/inamiy/type-safe-url-routing-in-swift" target="_blank" rel="external">swift</a>. But monad is too monad-y. My head just explodes.</p>
<p>One unique way to provide type routing is using reified generic! A demo <a href="https://vimeo.com/172310206" target="_blank" rel="external">video</a> has illustrted how to implment it.(Spoiler: for a function with type <code>A =&gt; Response</code>, one can access the class by  <code>A.type</code> and cast value by <code>guard let param: A = ....</code> in swift. Whoa, reification is powerful). Github repo is here: <a href="https://github.com/NougatFramework/Switchboard" target="_blank" rel="external">https://github.com/NougatFramework/Switchboard</a></p>
<p>Compile time reflection is ideal for routing thing. Yesod uses template haskell to do this, <a href="https://github.com/AndrewRademacher/routing-comparison/blob/master/yesod-test/src/Main.hs" target="_blank" rel="external">Example</a>. Macro paradise!</p>
<p>Scala has yet another unique construct called pattern match.  Tumblr’s <a href="https://tumblr.github.io/colossus/" target="_blank" rel="external">colossus</a> is a great example to use pattern match for type safe routing.</p>
<p>And of course, haskell has many type safe routing library. Check out the <a href="https://github.com/scotty-web/scotty/issues/60" target="_blank" rel="external">review</a> for more info.</p>
<p>JavaScript does not have powerful constructs like macro/pattern match. Combinator is the only way to achieve type safety but for client side component based routing, declaring more functions solely for routing doesn’t feel natural. And specifically TypeScript is still too feeble to describe routing. However, by combining tagged template, function overloading (or fun-dep), and intersection type (or row polymorphism), we can still do some interesting thing. If this were written in flow-type, more interesting thing could happen.</p>
<p>Frankly type safety in router does not grant you much: it cannot check tempalte code, it can only help you to double check the shape of parameters in <code>$route</code>. It can help you to type <code>router</code> instance better, but requires all routes to have a <code>name</code> field.</p>
<p>This is only a sketch for type safe routing design. Useful? No. Concise? Partly. Safety outweighs ease of use? No. Maybe it’s only suitable for type safe paranoid.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="interface"><span class="keyword">interface</span> Route&lt;T&gt; </span>&#123;</span><br><span class="line">  &lt;K extends <span class="built_in">string</span>, C&gt;(c: StaticRouteConfig&lt;K, C&gt;): Routes&lt;StaticRouteAct&lt;K&gt; &amp; C &amp; T&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">K</span> <span class="attribute">extends</span> <span class="attribute">string</span>, <span class="attribute">R</span>, <span class="attribute">P</span> <span class="attribute">extends</span> <span class="attribute">R</span>, <span class="attribute">C</span>&gt;</span>(c: RouteConfig<span class="tag">&lt;<span class="title">K,</span> <span class="attribute">R</span>, <span class="attribute">P</span>, <span class="attribute">C</span>&gt;</span>): Routes<span class="tag">&lt;<span class="title">RouteAct</span>&lt;<span class="attribute">K</span>, <span class="attribute">P</span>&gt;</span> &amp; C &amp; T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface StaticRouteAct<span class="tag">&lt;<span class="title">K</span>&gt;</span> &#123;</span><br><span class="line">  (location: &#123;name: K&#125;): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface RouteAct<span class="tag">&lt;<span class="title">K,</span> <span class="attribute">T</span>&gt;</span> &#123;</span><br><span class="line">  (location: &#123;name: K, params: T&#125;): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Router<span class="tag">&lt;<span class="title">T</span>&gt;</span> &#123;</span><br><span class="line">  push: T</span><br><span class="line">  replace: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Routes<span class="tag">&lt;<span class="title">T</span>&gt;</span> &#123;</span><br><span class="line">  route: Route<span class="tag">&lt;<span class="title">T</span>&gt;</span></span><br><span class="line">  done: () =&gt; Router<span class="tag">&lt;<span class="title">T</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface StaticRouteConfig<span class="tag">&lt;<span class="title">K</span> <span class="attribute">extends</span> <span class="attribute">string</span>, <span class="attribute">C</span>&gt;</span> &#123;</span><br><span class="line">  name: K</span><br><span class="line">  path: StaticPath,</span><br><span class="line">  children?: (p: OriginPath) =&gt; Routes<span class="tag">&lt;<span class="title">C</span>&gt;</span></span><br><span class="line">  component?: &#123;$routes?: &#123;params?: &#123;&#125;&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface RouteConfig<span class="tag">&lt;<span class="title">K</span> <span class="attribute">extends</span> <span class="attribute">string</span>, <span class="attribute">R</span>, <span class="attribute">P</span> <span class="attribute">extends</span> <span class="attribute">R</span>, <span class="attribute">C</span>&gt;</span>&#123;</span><br><span class="line">  name: K</span><br><span class="line">  path: Path<span class="tag">&lt;<span class="title">P</span>&gt;</span>,</span><br><span class="line">  children?: (p: PathMaker<span class="tag">&lt;<span class="title">P</span>&gt;</span>) =&gt; Routes<span class="tag">&lt;<span class="title">C</span>&gt;</span></span><br><span class="line">  component?: &#123;$routes?: &#123;params?: R&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Path<span class="tag">&lt;<span class="title">T</span>&gt;</span> &#123;</span><br><span class="line">  __pathBrand: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface StaticPath extends Path<span class="tag">&lt;<span class="title">&#123;&#125;</span>&gt;</span> &#123;</span><br><span class="line">  __staticPathBrand: never</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface PathMaker<span class="tag">&lt;<span class="title">Parent</span>&gt;</span> &#123;</span><br><span class="line">  <span class="tag">&lt;<span class="title">A,</span> <span class="attribute">B</span>&gt;</span>(t: TemplateStringsArray, n: A, n2: B): Path<span class="tag">&lt;<span class="title">A</span> &amp; <span class="attribute">B</span> &amp; <span class="attribute">Parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">A</span>&gt;</span>(t: TemplateStringsArray, n: A): Path<span class="tag">&lt;<span class="title">A</span> &amp; <span class="attribute">Parent</span>&gt;</span></span><br><span class="line">  (t: TemplateStringsArray): Path<span class="tag">&lt;<span class="title">Parent</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface OriginPath &#123;</span><br><span class="line">  __originPathBrand: never</span><br><span class="line">  <span class="tag">&lt;<span class="title">A,</span> <span class="attribute">B</span>&gt;</span>(t: TemplateStringsArray, n: A, n2: B): Path<span class="tag">&lt;<span class="title">A</span> &amp; <span class="attribute">B</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">A</span>&gt;</span>(t: TemplateStringsArray, n: A): Path<span class="tag">&lt;<span class="title">A</span>&gt;</span></span><br><span class="line">  (t: TemplateStringsArray): StaticPath</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var UserComponent =  &#123;$routes: &#123;params: &#123; uid: '333'&#125;&#125;&#125;</span><br><span class="line">const unimplement: never = null as never</span><br><span class="line">const route: Route<span class="tag">&lt;<span class="title">never</span>&gt;</span> = unimplement</span><br><span class="line">const p: OriginPath = unimplement</span><br><span class="line"></span><br><span class="line">const rs =</span><br><span class="line">route(&#123;</span><br><span class="line">  path: p`user/$&#123;&#123;uid: ''&#125;&#125;/profile/$&#123;&#123;pageType: ''&#125;&#125;`,</span><br><span class="line">  name: 'user',</span><br><span class="line">  component: UserComponent,</span><br><span class="line">  children: p =&gt; route(&#123;</span><br><span class="line">    name: 'tab',</span><br><span class="line">    path: p`tab/$&#123;&#123;tab: ''&#125;&#125;`,</span><br><span class="line">    component: &#123;$routes: &#123;params: &#123;uid: '123', tab: '333'&#125;&#125;&#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.route(&#123;</span><br><span class="line">  path: p`post`,</span><br><span class="line">  name: 'post'</span><br><span class="line">&#125;)</span><br><span class="line">.done()</span><br><span class="line"></span><br><span class="line">rs.push(&#123;name: 'post'&#125;)</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://herringtondarkholme.github.io/2016/10/02/vue-router/" data-id="citsps5t0000a54ejq2tvwwst" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/">TypeScript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/08/21/vue-ts/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Type Safety in Vue.js</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scala/">Scala</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/">Vim</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/">misc</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Scala/" style="font-size: 20px;">Scala</a> <a href="/tags/TypeScript/" style="font-size: 17.5px;">TypeScript</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/misc/" style="font-size: 12.5px;">misc</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/10/02/vue-router/">Type Safe Routing for Vue.js</a>
          </li>
        
          <li>
            <a href="/2016/08/21/vue-ts/">Type Safety in Vue.js</a>
          </li>
        
          <li>
            <a href="/2016/06/07/how-to-config-node-cdn/">A collection of nodejs CDN for Celestial Imperial</a>
          </li>
        
          <li>
            <a href="/2016/02/26/dein/">Trying out dein.vim -- a dark powered plugin manager</a>
          </li>
        
          <li>
            <a href="/2016/02/01/typesafe-di/">TypeSafe DI in TypeScript</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Herrington Darkholme<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>